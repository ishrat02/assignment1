<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sign Up</title>
</head>
<body>
<h1>Create Account</h1>

<p th:if="${error}" th:text="${error}"></p>

<form th:action="@{/signup}" th:object="${signup}" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <label>Username:</label>
    <input type="text" th:field="*{username}" /><br/><br/>

    <label>Password:</label>
    <input type="password" th:field="*{password}" /><br/><br/>

    <label>Role:</label>
    <select th:field="*{role}" id="role-select">
        <option value="STUDENT" selected>Student</option>
        <option value="TEACHER">Teacher</option>
    </select><br/><br/>

    <label>Name:</label>
    <input type="text" th:field="*{name}" /><br/><br/>

    <div id="student-fields">
        <label>Roll (students only):</label>
        <input type="text" th:field="*{roll}" /><br/><br/>
    </div>

    <div id="teacher-fields">
        <label>Email (teachers only):</label>
        <input type="email" th:field="*{email}" /><br/><br/>
    </div>

    <label>Department:</label>
    <select th:field="*{deptId}">
        <option value="">Select Department</option>
        <option th:each="dept : ${departments}" th:value="${dept.id}" th:text="${dept.name}"></option>
    </select><br/><br/>

    <button type="submit">Sign Up</button>
    <a th:href="@{/login}">Back to login</a>
</form>

<script>
    const roleSelect = document.getElementById("role-select");
    const studentFields = document.getElementById("student-fields");
    const teacherFields = document.getElementById("teacher-fields");

    function toggleRoleFields() {
        if (!roleSelect.value) {
            roleSelect.value = "STUDENT";
        }
        const isStudent = roleSelect.value === "STUDENT";
        studentFields.style.display = isStudent ? "block" : "none";
        teacherFields.style.display = isStudent ? "none" : "block";
    }

    roleSelect.addEventListener("change", toggleRoleFields);
    toggleRoleFields();
</script>
</body>
</html>
